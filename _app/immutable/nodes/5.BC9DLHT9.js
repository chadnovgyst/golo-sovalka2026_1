import"../chunks/CWj6FrbW.js";import"../chunks/CUGcy999.js";import{c as Ne,o as Ie,b as Ke,a as O,e as ee}from"../chunks/D823aWX5.js";import{af as qe,ao as R,m as f,T as N,ad as l,ap as Le,ag as z,am as h,k as t,ah as k,u,an as d,aq as K,aj as y,ak as Be,av as ke,ai as Se,q as ue,al as Oe,aw as Qe}from"../chunks/D4nwEpnC.js";import{i as B}from"../chunks/0hrKbzKX.js";import{h as Xe}from"../chunks/CRo46d9o.js";import{i as Re}from"../chunks/CI4_eMif.js";import{s as Ye,a as ze}from"../chunks/Du0o-kX8.js";import{s as fe,a as Me,B as Je}from"../chunks/Bvu6s98L.js";import{e as Pe,i as Ae}from"../chunks/CKtu-Lia.js";import{p as E}from"../chunks/DloNT35q.js";import{s as _e}from"../chunks/D-n5Fj80.js";import{b as De,g as ye}from"../chunks/BV2j2d1u.js";import{c as je,u as Ge,b as We,d as Ze,p as et}from"../chunks/_cFIceTT.js";const tt=6;let xe=0;const Ee=[],$e=new Map;function be(){if(xe>=tt)return;const j=Ee.shift();j&&j()}function Ue(j){if(!j)return Promise.resolve();const m=$e.get(j);if(m)return m;const a=new Promise((D,e)=>{const c=()=>{xe++;const S=new Image;S.decoding="async",S.loading="eager",S.src=j,S.onload=()=>{xe--,be(),D()},S.onerror=b=>{$e.delete(j),xe--,be(),e(b)}};typeof queueMicrotask=="function"?(Ee.push(c),queueMicrotask(be)):(Ee.push(c),be())});return $e.set(j,a),a}function Ve(j){j.forEach(m=>{Ue(m).catch(()=>{})})}var st=z('<div class="hero-skeleton svelte-z1hrta"></div>'),at=z('<div class="grid-cell svelte-z1hrta"><img class="grid-image svelte-z1hrta" loading="eager" decoding="async"/></div>'),it=z("<div></div>"),rt=z('<img loading="eager" decoding="async"/>'),nt=z('<div class="pattern-dot svelte-z1hrta"></div>'),ot=z('<div class="hero-fallback svelte-z1hrta"><div class="fallback-pattern svelte-z1hrta"></div></div>'),lt=z('<div class="detail-item description svelte-z1hrta"><span class="detail-text svelte-z1hrta"> </span></div>'),ct=z('<span class="tag weather svelte-z1hrta"> </span>'),vt=z('<span class="tag food svelte-z1hrta"> </span>'),dt=z('<span class="tag nightlife svelte-z1hrta"> </span>'),ut=z('<div class="city-details svelte-z1hrta"><!> <div class="detail-tags svelte-z1hrta"><!> <!> <!></div></div>'),ft=z('<div class="selection-overlay svelte-z1hrta"><div class="selection-pulse svelte-z1hrta"></div></div>'),gt=z('<button><div class="city-content svelte-z1hrta"><div><!> <!> <div class="city-info-panel svelte-z1hrta"><div class="city-title-section svelte-z1hrta"><h1 class="city-title svelte-z1hrta"> </h1> <div class="city-location svelte-z1hrta"> </div></div> <!></div></div></div> <!></button>');function mt(j,m){qe(m,!1);const a=N(),D=N();let e=E(m,"city",8),c=E(m,"variant",8,"single"),S=E(m,"position",8,"center"),b=E(m,"size",8,"medium"),U=E(m,"interactive",8,!0),X=E(m,"selected",8,!1),G=E(m,"disabled",8,!1);const Q=Ne();function le(){!U()||G()||Q("select",{city:e()})}function re(){!U()||G()||Q("hover",{city:e()})}function I(){!U()||G()||Q("focus",{city:e()})}let M=N([]),Y,w=N(!1),n=N(!1),r=null;function F(o){const s=[...o];for(let g=s.length-1;g>0;g--){const P=Math.floor(Math.random()*(g+1));[s[g],s[P]]=[s[P],s[g]]}return s}function ne(){if((c()==="single"||c()==="triple")&&e().images&&e().images.length>0){const o=c()==="triple"?3:9;if(e().images.length>=o)f(M,F([...e().images]).slice(0,o));else{const s=[],g=[...e().images],P=F([...g]);s.push(...P);const A=o-g.length;for(let x=0;x<A;x++){const v=new Map;g.forEach(L=>v.set(L,0)),s.forEach((L,W)=>{const C=1/(s.length-W);v.set(L,(v.get(L)||0)+C)});let _=g[0],ie=v.get(_)||0;for(const L of g){const W=v.get(L)||0;W<ie&&(ie=W,_=L)}s.push(_)}f(M,s)}}}function ce(){if(c()==="single"&&e().images&&e().images.length>1){if(e().images.length<3)return;const o=Math.min(Math.floor(Math.random()*2)+1,e().images.length-t(M).length),s=[...t(M)];for(let g=0;g<o;g++){const P=Math.floor(Math.random()*s.length);let A=0,x;const v=e().images.filter(_=>!s.includes(_));if(v.length>0){const _=Math.floor(Math.random()*v.length);x=v[_]}else do{const _=Math.floor(Math.random()*e().images.length);if(x=e().images[_],A++,!(s[P]===x&&A<20||s.filter(L=>L===x).length>0&&A<20))break}while(A<25);s[P]=x}f(M,s)}}Ie(()=>{ne(),Y=setInterval(()=>{ce()},3e3)}),Ke(()=>{Y&&clearInterval(Y)});function i(){const o=`${e().slug}|${c()}`;if(!e().images||!e().images.length){f(w,!0),f(n,!0),r=o;return}if(o===r)return;r=o,f(w,!1),f(n,!1);const s=e().heroImage||e().images[0];s?Ue(s).then(()=>{f(n,!0),f(w,!0)}).catch(()=>{f(n,!0),f(w,!0)}):(f(n,!0),f(w,!0));const g=c()==="triple"?3:9;Ve(e().images.slice(0,g))}Ie(()=>{i()}),R(()=>l(e()),()=>{f(a,e().status==="1"?"approved":e().status==="0"?"rejected":"undecided")}),R(()=>l(e()),()=>{f(D,e().images?.length||0)}),R(()=>l(e()),()=>{e().slug&&ne()}),R(()=>l(e()),()=>{e().slug&&i()}),Le(),Re();var p=gt();let V;var T=h(p),te=h(T);let oe;var J=h(te);{var q=o=>{var s=st();y(o,s)};B(J,o=>{t(w)||o(q)})}var H=k(J,2);{var se=o=>{var s=it();let g;Pe(s,5,()=>t(M),Ae,(P,A,x)=>{var v=at();Me(v,`--animation-delay: ${x*.1}s`);var _=h(v);d(v),K(()=>{_e(_,"src",t(A)),_e(_,"alt",(l(e()),u(()=>e().name)))}),ee("load",_,()=>{t(w)||f(w,!0)}),y(P,v)}),d(s),K(()=>g=fe(s,1,"image-grid svelte-z1hrta",null,g,{vertical:c()==="triple"})),y(o,s)},Ce=o=>{var s=ke(),g=Se(s);{var P=x=>{var v=rt();let _;K(()=>{_e(v,"src",(l(e()),u(()=>e().images[0]))),_e(v,"alt",`${l(e()),u(()=>e().name)??""}, ${l(e()),u(()=>e().country)??""}`),_=fe(v,1,"hero-image svelte-z1hrta",null,_,{loaded:t(n)})}),ee("load",v,()=>{f(n,!0),f(w,!0)}),y(x,v)},A=x=>{var v=ot(),_=h(v);Pe(_,4,()=>Array(12),Ae,(ie,L,W)=>{var C=nt();Me(C,`animation-delay: ${W*.15}s`),y(ie,C)}),d(_),d(v),y(x,v)};B(g,x=>{l(e()),u(()=>e().images&&e().images.length>0)?x(P):x(A,!1)},!0)}y(o,s)};B(H,o=>{l(c()),t(M),u(()=>(c()==="single"||c()==="triple")&&t(M).length>0)?o(se):o(Ce,!1)})}var ve=k(H,2),de=h(ve),ae=h(de),ge=h(ae,!0);d(ae);var me=k(ae,2),he=h(me,!0);d(me),d(de);var pe=k(de,2);{var we=o=>{var s=ut(),g=h(s);{var P=C=>{var $=lt(),Z=h($),He=h(Z,!0);d(Z),d($),K(()=>O(He,(l(e()),u(()=>e().description)))),y(C,$)};B(g,C=>{l(e()),u(()=>e().description)&&C(P)})}var A=k(g,2),x=h(A);{var v=C=>{var $=ct(),Z=h($);d($),K(()=>O(Z,`ðŸŒ¤ï¸ ${l(e()),u(()=>e().weather)??""}`)),y(C,$)};B(x,C=>{l(e()),u(()=>e().weather)&&C(v)})}var _=k(x,2);{var ie=C=>{var $=vt(),Z=h($);d($),K(()=>O(Z,`ðŸ½ï¸ ${l(e()),u(()=>e().food)??""}`)),y(C,$)};B(_,C=>{l(e()),u(()=>e().food)&&C(ie)})}var L=k(_,2);{var W=C=>{var $=dt(),Z=h($);d($),K(()=>O(Z,`ðŸŒ™ ${l(e()),u(()=>e().nightlife)??""}`)),y(C,$)};B(L,C=>{l(e()),u(()=>e().nightlife)&&C(W)})}d(A),d(s),y(o,s)};B(pe,o=>{l(e()),u(()=>e().description||e().weather||e().food||e().nightlife)&&o(we)})}d(ve),d(te),d(T);var Fe=k(T,2);{var Te=o=>{var s=ft();y(o,s)};B(Fe,o=>{X()&&o(Te)})}d(p),K(()=>{V=fe(p,1,`city-card ${c()??""} ${S()??""} ${b()??""} ${t(a)??""}`,"svelte-z1hrta",V,{selected:X(),disabled:G(),interactive:U()}),p.disabled=G(),oe=fe(te,1,"city-hero svelte-z1hrta",null,oe,{loaded:t(w)}),O(ge,(l(e()),u(()=>e().name))),O(he,(l(e()),u(()=>e().country)))}),ee("click",p,le),ee("mouseenter",p,re),ee("focus",p,I),y(j,p),Be()}var ht=z("<div></div>");function pt(j,m){qe(m,!1);const a=N(),D=N();let e=E(m,"cities",24,()=>[]),c=E(m,"cardCount",8,1),S=E(m,"layout",8,"horizontal"),b=E(m,"interactive",8,!0),U=E(m,"selectedCities",24,()=>[]),X=E(m,"disabledCities",24,()=>[]);const G=Ne();function Q(n,r){if(r==="horizontal")return{columns:n,rows:1};if(r==="vertical")return{columns:1,rows:n};if(r==="triad")return{columns:3,rows:1};switch(n){case 1:return{columns:1,rows:1};case 2:return{columns:2,rows:1};case 3:return{columns:3,rows:1};case 4:return{columns:2,rows:2};default:return{columns:1,rows:1}}}function le(n){switch(n){case 1:return"single";case 2:return"pair";case 3:return"triple";case 4:return"quad";default:return"single"}}function re(n,r){return r===1?"center":r===2?n===0?"left":"right":r===3?n===0?"left":n===1?"center":"right":r===4&&["top-left","top-right","bottom-left","bottom-right"][n]||"center"}function I(n,r){G("citySelect",{city:n.detail.city,index:r})}function M(n,r){G("cityHover",{city:n.detail.city,index:r})}function Y(n,r){G("cityFocus",{city:n.detail.city,index:r})}R(()=>(l(e()),l(c())),()=>{f(a,e().slice(0,c()))}),R(()=>(t(a),Ve),()=>{if(t(a).length){const n=t(a).map(r=>r.heroImage??r.images?.[0]).filter(r=>!!r);Ve(n)}}),R(()=>(l(c()),l(S())),()=>{f(D,Q(c(),S()))}),Le(),Re();var w=ht();Pe(w,5,()=>t(a),Ae,(n,r,F)=>{{let ne=ue(()=>(l(c()),u(()=>le(c())))),ce=ue(()=>(l(c()),u(()=>re(F,c())))),i=ue(()=>(l(U()),t(r),u(()=>U().includes(t(r).slug)))),p=ue(()=>(l(X()),t(r),u(()=>X().includes(t(r).slug))));mt(n,{get city(){return t(r)},get variant(){return t(ne)},get position(){return t(ce)},size:"medium",get interactive(){return b()},get selected(){return t(i)},get disabled(){return t(p)},$$events:{select:V=>I(V,F),hover:V=>M(V,F),focus:V=>Y(V,F)}})}}),d(w),K(()=>{fe(w,1,`city-card-grid ${S()??""}`,"svelte-efmsim"),Me(w,`--grid-columns: ${t(D),u(()=>t(D).columns)??""}; --grid-rows: ${t(D),u(()=>t(D).rows)??""};`)}),y(j,w),Be()}var _t=z(`<div class="voting-complete svelte-1xlijvp"><h3 class="svelte-1xlijvp">ðŸŽ‰ Voting Complete!</h3> <p class="svelte-1xlijvp">You've made decisions on all cities.</p></div>`),yt=z('<div class="city-cards-area svelte-1xlijvp"><!></div>'),bt=z('<div class="voting-controls svelte-1xlijvp"><h3 class="svelte-1xlijvp">Vote on City</h3> <div class="current-city-info svelte-1xlijvp"><div class="city-name svelte-1xlijvp"> </div> <div class="city-country svelte-1xlijvp"> </div></div> <div class="vote-buttons svelte-1xlijvp"><button class="vote-btn approve svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">â†‘</span> <span class="vote-text svelte-1xlijvp">Approve</span></button> <button class="vote-btn reject svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">â†“</span> <span class="vote-text svelte-1xlijvp">Reject</span></button></div> <div class="progress-info svelte-1xlijvp"> <br/> </div></div>'),xt=z('<div class="loading svelte-1xlijvp">Loading...</div>');function Lt(j,m){qe(m,!1);const a=()=>ze(je,"$currentSession",c),D=()=>ze(et,"$progress",c),e=()=>ze(Ze,"$binaryString",c),[c,S]=Ye(),b=N(),U=N(),X=N();function G(){if(De)return De;if(typeof window>"u")return"";const i=window.location.pathname.match(/^\/[^/]+/);return i?i[0]:""}const Q=G(),le=Q||"/",re=Q?`${Q}/results`:"/results";Ie(()=>{(typeof je.load=="function"?je.load():null)||ye(le)});let I=N(0);function M(){!a()||!t(b)||(console.log(`âœ… Approving ${t(b).name}`),Ge(t(b).slug,"1"),w())}function Y(){!a()||!t(b)||(console.log(`âŒ Rejecting ${t(b).name}`),Ge(t(b).slug,"0"),w())}function w(){if(!a())return;const i=a().cities.findIndex((p,V)=>V>t(I)&&p.status==="?");i!==-1?(f(I,i),console.log(`ðŸ“ Moving to city ${i+1}: ${a().cities[i].name}`)):(console.log("ðŸŽ‰ Voting complete!"),We(),ye(re))}function n(i){if(a())switch(i.key){case"ArrowUp":i.preventDefault(),M();break;case"ArrowDown":i.preventDefault(),Y();break}}R(()=>(a(),t(I)),()=>{if(a()&&a().cities){const i=a().cities.findIndex(p=>p.status==="?");i!==-1&&t(I)!==i&&(f(I,i),console.log(`ðŸ”„ Set current city index to ${t(I)} (first undecided: ${a().cities[t(I)]?.name})`))}}),R(()=>(a(),t(I)),()=>{f(b,a()?.cities[t(I)])}),R(()=>a(),()=>{f(U,a()?.cities.filter(i=>i.status==="?").length||0)}),R(()=>a(),()=>{f(X,a()?[...a().cities].sort((i,p)=>i.name.localeCompare(p.name)):[])}),R(()=>(a(),ye),()=>{a()?.isComplete&&ye(re)}),Le(),Re();var r=ke();Xe("1xlijvp",i=>{Oe.title="City Voting - City Voting System"}),ee("keydown",Qe,n);var F=Se(r);{var ne=i=>{Je(i,{title:"City Voting",get progress(){return D()},get binaryString(){return e()},get cities(){return t(X)},controls:"Press â†‘ to approve this city, â†“ to reject it.",showBackButton:!0,children:(p,V)=>{var T=yt(),te=h(T);{var oe=q=>{{let H=ue(()=>[t(b)]);pt(q,{get cities(){return t(H)},cardCount:1,layout:"horizontal",$$events:{citySelect:se=>console.log("City selected:",se.detail)}})}},J=q=>{var H=_t();y(q,H)};B(te,q=>{t(b)?q(oe):q(J,!1)})}d(T),y(p,T)},$$slots:{default:!0,"voting-actions":(p,V)=>{var T=ke(),te=Se(T);{var oe=J=>{var q=bt(),H=k(h(q),2),se=h(H),Ce=h(se,!0);d(se);var ve=k(se,2),de=h(ve,!0);d(ve),d(H);var ae=k(H,2),ge=h(ae),me=k(ge,2);d(ae);var he=k(ae,2),pe=h(he),we=k(pe,2);d(he),d(q),K(()=>{O(Ce,(t(b),u(()=>t(b).name))),O(de,(t(b),u(()=>t(b).country))),O(pe,`City ${t(I)+1} of ${a(),u(()=>a().cities.length)??""} `),O(we,` ${t(U)??""} remaining`)}),ee("click",ge,M),ee("click",me,Y),y(J,q)};B(te,J=>{t(b)&&J(oe)})}y(p,T)}}})},ce=i=>{var p=xt();y(i,p)};B(F,i=>{a()?i(ne):i(ce,!1)})}y(j,r),Be(),S()}export{Lt as component};
