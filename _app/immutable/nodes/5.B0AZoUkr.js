import"../chunks/CWj6FrbW.js";import"../chunks/DZXuOcnk.js";import{h as Ae,as as Ee,at as Le,au as Ge,av as Ne,ab as we,ak as D,k as q,N as K,a9 as o,al as $e,ac as j,ai as m,i as t,u as c,ad as E,aj as l,am as T,af as C,ag as ze,ar as pe,ae as _e,n as ne,ah as qe,aw as Ve}from"../chunks/BwOj8YvN.js";import{c as Me,o as De,b as Re,a as U,e as H}from"../chunks/kEgIIrK5.js";import{i as V}from"../chunks/BCV1tJ84.js";import{h as Be}from"../chunks/CT_8VmLx.js";import{i as je}from"../chunks/Q-DUCnJu.js";import{s as Fe,a as he}from"../chunks/BleXULIb.js";import{s as ye,a as Ce,B as Pe}from"../chunks/BK1WkYoX.js";import{e as xe,i as be}from"../chunks/BwaOt-lj.js";import{p as L}from"../chunks/CUPbJyU1.js";import{g as me}from"../chunks/Cz9SuPv1.js";import{c as Te,u as Ie,b as He,d as Ue,p as Oe}from"../chunks/B9lk1V79.js";const Ke=Symbol("is custom element"),Ye=Symbol("is html");function ge(d,a,i,I){var e=Je(d);Ae&&(e[a]=d.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&d.nodeName==="LINK")||e[a]!==(e[a]=i)&&(a==="loading"&&(d[Ee]=i),i==null?d.removeAttribute(a):typeof i!="string"&&Qe(d).includes(a)?d[a]=i:d.setAttribute(a,i))}function Je(d){return d.__attributes??(d.__attributes={[Ke]:d.nodeName.includes("-"),[Ye]:d.namespaceURI===Le})}var Se=new Map;function Qe(d){var a=d.getAttribute("is")||d.nodeName,i=Se.get(a);if(i)return i;Se.set(a,i=[]);for(var I,e=d,u=Element.prototype;u!==e;){I=Ne(e);for(var R in I)I[R].set&&i.push(R);e=Ge(e)}return i}var We=j('<div class="grid-cell svelte-z1hrta"><img class="grid-image svelte-z1hrta"/></div>'),Xe=j("<div></div>"),Ze=j('<img class="hero-image svelte-z1hrta"/>'),et=j('<div class="pattern-dot svelte-z1hrta"></div>'),tt=j('<div class="hero-fallback svelte-z1hrta"><div class="fallback-pattern svelte-z1hrta"></div></div>'),st=j('<div class="detail-item description svelte-z1hrta"><span class="detail-text svelte-z1hrta"> </span></div>'),it=j('<span class="tag weather svelte-z1hrta"> </span>'),at=j('<span class="tag food svelte-z1hrta"> </span>'),rt=j('<span class="tag nightlife svelte-z1hrta"> </span>'),ot=j('<div class="city-details svelte-z1hrta"><!> <div class="detail-tags svelte-z1hrta"><!> <!> <!></div></div>'),nt=j('<div class="selection-overlay svelte-z1hrta"><div class="selection-pulse svelte-z1hrta"></div></div>'),lt=j('<button><div class="city-content svelte-z1hrta"><div class="city-hero svelte-z1hrta"><!> <div class="city-info-panel svelte-z1hrta"><div class="city-title-section svelte-z1hrta"><h1 class="city-title svelte-z1hrta"> </h1> <div class="city-location svelte-z1hrta"> </div></div> <!></div></div></div> <!></button>');function ct(d,a){we(a,!1);const i=K(),I=K();let e=L(a,"city",8),u=L(a,"variant",8,"single"),R=L(a,"position",8,"center"),b=L(a,"size",8,"medium"),B=L(a,"interactive",8,!0),Y=L(a,"selected",8,!1),_=L(a,"disabled",8,!1);const J=Me();function te(){!B()||_()||J("select",{city:e()})}function se(){!B()||_()||J("hover",{city:e()})}function ae(){!B()||_()||J("focus",{city:e()})}let x=K([]),ee;function F(g){const r=[...g];for(let p=r.length-1;p>0;p--){const $=Math.floor(Math.random()*(p+1));[r[p],r[$]]=[r[$],r[p]]}return r}function f(){if((u()==="single"||u()==="triple")&&e().images&&e().images.length>0){const g=u()==="triple"?3:9;if(e().images.length>=g)q(x,F([...e().images]).slice(0,g));else{const p=[],$=[...e().images],M=F([...$]);p.push(...M);const w=g-$.length;for(let v=0;v<w;v++){const y=new Map;$.forEach(A=>y.set(A,0)),p.forEach((A,h)=>{const z=1/(p.length-h);y.set(A,(y.get(A)||0)+z)});let k=$[0],ie=y.get(k)||0;for(const A of $){const h=y.get(A)||0;h<ie&&(ie=h,k=A)}p.push(k)}q(x,p)}const r=new Set(t(x)).size;console.log(`ðŸŽ­ Grid for ${e().name}: ${t(x).length} total, ${r} unique (${(r/t(x).length*100).toFixed(0)}% unique)`)}}function s(){if(u()==="single"&&e().images&&e().images.length>1){if(e().images.length<3){console.log(`â³ Skipping rotation for ${e().name}: only ${e().images.length} images available`);return}const g=Math.min(Math.floor(Math.random()*2)+1,e().images.length-t(x).length),r=[...t(x)];for(let $=0;$<g;$++){const M=Math.floor(Math.random()*r.length);let w=0,v;const y=e().images.filter(k=>!r.includes(k));if(y.length>0){const k=Math.floor(Math.random()*y.length);v=y[k]}else do{const k=Math.floor(Math.random()*e().images.length);if(v=e().images[k],w++,!(r[M]===v&&w<20||r.filter(A=>A===v).length>0&&w<20))break}while(w<25);r[M]=v}q(x,r);const p=new Set(t(x)).size;console.log(`ðŸ”„ Rotated grid for ${e().name}: ${p} unique of ${t(x).length} total (${(p/t(x).length*100).toFixed(0)}% unique)`)}}De(()=>{f(),ee=setInterval(()=>{s()},3e3)}),Re(()=>{ee&&clearInterval(ee)}),D(()=>o(e()),()=>{q(i,e().status==="1"?"approved":e().status==="0"?"rejected":"undecided")}),D(()=>o(e()),()=>{console.log("CityCard data:",e())}),D(()=>o(e()),()=>{q(I,e().images?.length||0)}),D(()=>o(e()),()=>{e().slug&&f()}),$e(),je();var n=lt();let Q;var G=m(n),W=m(G),X=m(W);{var S=g=>{var r=Xe();let p;xe(r,5,()=>t(x),be,($,M,w)=>{var v=We();Ce(v,`--animation-delay: ${w*.1}s`);var y=m(v);l(v),T(()=>{ge(y,"src",t(M)),ge(y,"alt",(o(e()),c(()=>e().name)))}),H("load",y,()=>console.log(`âœ… Grid image loaded: ${t(M)}`)),H("error",y,()=>console.error(`âŒ Grid image failed: ${t(M)}`)),C($,v)}),l(r),T(()=>p=ye(r,1,"image-grid svelte-z1hrta",null,p,{vertical:u()==="triple"})),C(g,r)},N=g=>{var r=pe(),p=_e(r);{var $=w=>{var v=Ze();T(()=>{ge(v,"src",(o(e()),c(()=>e().images[0]))),ge(v,"alt",`${o(e()),c(()=>e().name)??""}, ${o(e()),c(()=>e().country)??""}`)}),H("load",v,()=>console.log(`âœ… Image loaded: ${e().images[0]}`)),H("error",v,()=>console.error(`âŒ Image failed: ${e().images[0]}`)),C(w,v)},M=w=>{var v=tt(),y=m(v);xe(y,4,()=>Array(12),be,(k,ie,A)=>{var h=et();Ce(h,`animation-delay: ${A*.15}s`),C(k,h)}),l(y),l(v),C(w,v)};V(p,w=>{o(e()),c(()=>e().images&&e().images.length>0)?w($):w(M,!1)},!0)}C(g,r)};V(X,g=>{o(u()),t(x),c(()=>(u()==="single"||u()==="triple")&&t(x).length>0)?g(S):g(N,!1)})}var P=E(X,2),O=m(P),re=m(O),le=m(re,!0);l(re);var ce=E(re,2),oe=m(ce,!0);l(ce),l(O);var ve=E(O,2);{var fe=g=>{var r=ot(),p=m(r);{var $=h=>{var z=st(),Z=m(z),ke=m(Z,!0);l(Z),l(z),T(()=>U(ke,(o(e()),c(()=>e().description)))),C(h,z)};V(p,h=>{o(e()),c(()=>e().description)&&h($)})}var M=E(p,2),w=m(M);{var v=h=>{var z=it(),Z=m(z);l(z),T(()=>U(Z,`ðŸŒ¤ï¸ ${o(e()),c(()=>e().weather)??""}`)),C(h,z)};V(w,h=>{o(e()),c(()=>e().weather)&&h(v)})}var y=E(w,2);{var k=h=>{var z=at(),Z=m(z);l(z),T(()=>U(Z,`ðŸ½ï¸ ${o(e()),c(()=>e().food)??""}`)),C(h,z)};V(y,h=>{o(e()),c(()=>e().food)&&h(k)})}var ie=E(y,2);{var A=h=>{var z=rt(),Z=m(z);l(z),T(()=>U(Z,`ðŸŒ™ ${o(e()),c(()=>e().nightlife)??""}`)),C(h,z)};V(ie,h=>{o(e()),c(()=>e().nightlife)&&h(A)})}l(M),l(r),C(g,r)};V(ve,g=>{o(e()),c(()=>e().description||e().weather||e().food||e().nightlife)&&g(fe)})}l(P),l(W),l(G);var de=E(G,2);{var ue=g=>{var r=nt();C(g,r)};V(de,g=>{Y()&&g(ue)})}l(n),T(()=>{Q=ye(n,1,`city-card ${u()??""} ${R()??""} ${b()??""} ${t(i)??""}`,"svelte-z1hrta",Q,{selected:Y(),disabled:_(),interactive:B()}),n.disabled=_(),U(le,(o(e()),c(()=>e().name))),U(oe,(o(e()),c(()=>e().country)))}),H("click",n,te),H("mouseenter",n,se),H("focus",n,ae),C(d,n),ze()}var vt=j("<div></div>");function dt(d,a){we(a,!1);const i=K(),I=K();let e=L(a,"cities",24,()=>[]),u=L(a,"cardCount",8,1),R=L(a,"layout",8,"horizontal"),b=L(a,"interactive",8,!0),B=L(a,"selectedCities",24,()=>[]),Y=L(a,"disabledCities",24,()=>[]);const _=Me();function J(f,s){if(s==="horizontal")return{columns:f,rows:1};if(s==="vertical")return{columns:1,rows:f};if(s==="triad")return{columns:3,rows:1};switch(f){case 1:return{columns:1,rows:1};case 2:return{columns:2,rows:1};case 3:return{columns:3,rows:1};case 4:return{columns:2,rows:2};default:return{columns:1,rows:1}}}function te(f){switch(f){case 1:return"single";case 2:return"pair";case 3:return"triple";case 4:return"quad";default:return"single"}}function se(f,s){return s===1?"center":s===2?f===0?"left":"right":s===3?f===0?"left":f===1?"center":"right":s===4&&["top-left","top-right","bottom-left","bottom-right"][f]||"center"}function ae(f,s){_("citySelect",{city:f.detail.city,index:s})}function x(f,s){_("cityHover",{city:f.detail.city,index:s})}function ee(f,s){_("cityFocus",{city:f.detail.city,index:s})}D(()=>(o(e()),o(u())),()=>{q(i,e().slice(0,u()))}),D(()=>(o(u()),o(R())),()=>{q(I,J(u(),R()))}),$e(),je();var F=vt();xe(F,5,()=>t(i),be,(f,s,n)=>{{let Q=ne(()=>(o(u()),c(()=>te(u())))),G=ne(()=>(o(u()),c(()=>se(n,u())))),W=ne(()=>(o(B()),t(s),c(()=>B().includes(t(s).slug)))),X=ne(()=>(o(Y()),t(s),c(()=>Y().includes(t(s).slug))));ct(f,{get city(){return t(s)},get variant(){return t(Q)},get position(){return t(G)},size:"medium",get interactive(){return b()},get selected(){return t(W)},get disabled(){return t(X)},$$events:{select:S=>ae(S,n),hover:S=>x(S,n),focus:S=>ee(S,n)}})}}),l(F),T(()=>{ye(F,1,`city-card-grid ${R()??""}`,"svelte-efmsim"),Ce(F,`--grid-columns: ${t(I),c(()=>t(I).columns)??""}; --grid-rows: ${t(I),c(()=>t(I).rows)??""};`)}),C(d,F),ze()}var ut=j(`<div class="voting-complete svelte-1xlijvp"><h3 class="svelte-1xlijvp">ðŸŽ‰ Voting Complete!</h3> <p class="svelte-1xlijvp">You've made decisions on all cities.</p></div>`),gt=j('<div class="city-cards-area svelte-1xlijvp"><!></div>'),ft=j('<div class="voting-controls svelte-1xlijvp"><h3 class="svelte-1xlijvp">Vote on City</h3> <div class="current-city-info svelte-1xlijvp"><div class="city-name svelte-1xlijvp"> </div> <div class="city-country svelte-1xlijvp"> </div></div> <div class="vote-buttons svelte-1xlijvp"><button class="vote-btn approve svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">â†‘</span> <span class="vote-text svelte-1xlijvp">Approve</span></button> <button class="vote-btn reject svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">â†“</span> <span class="vote-text svelte-1xlijvp">Reject</span></button></div> <div class="progress-info svelte-1xlijvp"> <br/> </div></div>'),ht=j('<div class="loading svelte-1xlijvp">Loading...</div>');function Mt(d,a){we(a,!1);const i=()=>he(Te,"$currentSession",u),I=()=>he(Oe,"$progress",u),e=()=>he(Ue,"$binaryString",u),[u,R]=Fe(),b=K(),B=K(),Y=K();let _=K(0);function J(){!i()||!t(b)||(console.log(`âœ… Approving ${t(b).name}`),Ie(t(b).slug,"1"),se())}function te(){!i()||!t(b)||(console.log(`âŒ Rejecting ${t(b).name}`),Ie(t(b).slug,"0"),se())}function se(){if(!i())return;const s=i().cities.findIndex((n,Q)=>Q>t(_)&&n.status==="?");s!==-1?(q(_,s),console.log(`ðŸ“ Moving to city ${s+1}: ${i().cities[s].name}`)):(console.log("ðŸŽ‰ Voting complete!"),He(),me("/results"))}function ae(s){if(i())switch(s.key){case"ArrowUp":s.preventDefault(),J();break;case"ArrowDown":s.preventDefault(),te();break}}D(()=>(i(),t(_)),()=>{if(i()&&i().cities){const s=i().cities.findIndex(n=>n.status==="?");s!==-1&&t(_)!==s&&(q(_,s),console.log(`ðŸ”„ Set current city index to ${t(_)} (first undecided: ${i().cities[t(_)]?.name})`))}}),D(()=>(i(),t(_)),()=>{q(b,i()?.cities[t(_)])}),D(()=>i(),()=>{q(B,i()?.cities.filter(s=>s.status==="?").length||0)}),D(()=>i(),()=>{q(Y,i()?[...i().cities].sort((s,n)=>s.name.localeCompare(n.name)):[])}),D(()=>(i(),me),()=>{i()?.isComplete&&me("/results")}),$e(),je();var x=pe();Be("1xlijvp",s=>{qe.title="City Voting - City Voting System"}),H("keydown",Ve,ae);var ee=_e(x);{var F=s=>{Pe(s,{title:"City Voting",get progress(){return I()},get binaryString(){return e()},get cities(){return t(Y)},controls:"Press â†‘ to approve this city, â†“ to reject it.",showBackButton:!0,children:(n,Q)=>{var G=gt(),W=m(G);{var X=N=>{{let P=ne(()=>[t(b)]);dt(N,{get cities(){return t(P)},cardCount:1,layout:"horizontal",$$events:{citySelect:O=>console.log("City selected:",O.detail)}})}},S=N=>{var P=ut();C(N,P)};V(W,N=>{t(b)?N(X):N(S,!1)})}l(G),C(n,G)},$$slots:{default:!0,"voting-actions":(n,Q)=>{var G=pe(),W=_e(G);{var X=S=>{var N=ft(),P=E(m(N),2),O=m(P),re=m(O,!0);l(O);var le=E(O,2),ce=m(le,!0);l(le),l(P);var oe=E(P,2),ve=m(oe),fe=E(ve,2);l(oe);var de=E(oe,2),ue=m(de),g=E(ue,2);l(de),l(N),T(()=>{U(re,(t(b),c(()=>t(b).name))),U(ce,(t(b),c(()=>t(b).country))),U(ue,`City ${t(_)+1} of ${i(),c(()=>i().cities.length)??""} `),U(g,` ${t(B)??""} remaining`)}),H("click",ve,J),H("click",fe,te),C(S,N)};V(W,S=>{t(b)&&S(X)})}C(n,G)}}})},f=s=>{var n=ht();C(s,n)};V(ee,s=>{i()?s(F):s(f,!1)})}C(d,x),ze(),R()}export{Mt as component};
