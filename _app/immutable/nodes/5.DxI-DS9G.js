import"../chunks/CWj6FrbW.js";import"../chunks/CUGcy999.js";import{af as Ce,ao as L,m as V,T as J,ad as r,ap as $e,ag as $,am as g,k as t,u as n,ah as I,an as o,aq as F,aj as _,ak as we,av as Ie,ai as pe,q as le,al as Me,aw as qe}from"../chunks/D4nwEpnC.js";import{c as ke,o as Ge,b as Ve,a as E,e as U}from"../chunks/D823aWX5.js";import{i as B}from"../chunks/0hrKbzKX.js";import{h as Ae}from"../chunks/CRo46d9o.js";import{i as ze}from"../chunks/CI4_eMif.js";import{s as Pe,a as me}from"../chunks/Du0o-kX8.js";import{s as _e,a as ye,B as De}from"../chunks/ofHGR1wo.js";import{e as xe,i as be}from"../chunks/CKtu-Lia.js";import{p as G}from"../chunks/DloNT35q.js";import{s as de}from"../chunks/D-n5Fj80.js";import{g as he,b as Fe}from"../chunks/D4men7tP.js";import{c as Be,u as je,b as Ee,d as Le,p as Re}from"../chunks/tB02VBBH.js";var He=$('<div class="grid-cell svelte-z1hrta"><img class="grid-image svelte-z1hrta"/></div>'),Ue=$("<div></div>"),Ke=$('<img class="hero-image svelte-z1hrta"/>'),Ne=$('<div class="pattern-dot svelte-z1hrta"></div>'),Ye=$('<div class="hero-fallback svelte-z1hrta"><div class="fallback-pattern svelte-z1hrta"></div></div>'),Je=$('<div class="detail-item description svelte-z1hrta"><span class="detail-text svelte-z1hrta"> </span></div>'),Oe=$('<span class="tag weather svelte-z1hrta"> </span>'),Qe=$('<span class="tag food svelte-z1hrta"> </span>'),Te=$('<span class="tag nightlife svelte-z1hrta"> </span>'),We=$('<div class="city-details svelte-z1hrta"><!> <div class="detail-tags svelte-z1hrta"><!> <!> <!></div></div>'),Xe=$('<div class="selection-overlay svelte-z1hrta"><div class="selection-pulse svelte-z1hrta"></div></div>'),Ze=$('<button><div class="city-content svelte-z1hrta"><div class="city-hero svelte-z1hrta"><!> <div class="city-info-panel svelte-z1hrta"><div class="city-title-section svelte-z1hrta"><h1 class="city-title svelte-z1hrta"> </h1> <div class="city-location svelte-z1hrta"> </div></div> <!></div></div></div> <!></button>');function et(ie,x){Ce(x,!1);const i=J(),K=J();let e=G(x,"city",8),f=G(x,"variant",8,"single"),Z=G(x,"position",8,"center"),b=G(x,"size",8,"medium"),R=G(x,"interactive",8,!0),O=G(x,"selected",8,!1),h=G(x,"disabled",8,!1);const Q=ke();function te(){!R()||h()||Q("select",{city:e()})}function se(){!R()||h()||Q("hover",{city:e()})}function re(){!R()||h()||Q("focus",{city:e()})}let y=J([]),T;function H(l){const a=[...l];for(let m=a.length-1;m>0;m--){const w=Math.floor(Math.random()*(m+1));[a[m],a[w]]=[a[w],a[m]]}return a}function d(){if((f()==="single"||f()==="triple")&&e().images&&e().images.length>0){const l=f()==="triple"?3:9;if(e().images.length>=l)V(y,H([...e().images]).slice(0,l));else{const m=[],w=[...e().images],S=H([...w]);m.push(...S);const C=l-w.length;for(let c=0;c<C;c++){const p=new Map;w.forEach(q=>p.set(q,0)),m.forEach((q,u)=>{const z=1/(m.length-u);p.set(q,(p.get(q)||0)+z)});let M=w[0],ae=p.get(M)||0;for(const q of w){const u=p.get(q)||0;u<ae&&(ae=u,M=q)}m.push(M)}V(y,m)}const a=new Set(t(y)).size;console.log(`ðŸŽ­ Grid for ${e().name}: ${t(y).length} total, ${a} unique (${(a/t(y).length*100).toFixed(0)}% unique)`)}}function v(){if(f()==="single"&&e().images&&e().images.length>1){if(e().images.length<3){console.log(`â³ Skipping rotation for ${e().name}: only ${e().images.length} images available`);return}const l=Math.min(Math.floor(Math.random()*2)+1,e().images.length-t(y).length),a=[...t(y)];for(let w=0;w<l;w++){const S=Math.floor(Math.random()*a.length);let C=0,c;const p=e().images.filter(M=>!a.includes(M));if(p.length>0){const M=Math.floor(Math.random()*p.length);c=p[M]}else do{const M=Math.floor(Math.random()*e().images.length);if(c=e().images[M],C++,!(a[S]===c&&C<20||a.filter(q=>q===c).length>0&&C<20))break}while(C<25);a[S]=c}V(y,a);const m=new Set(t(y)).size;console.log(`ðŸ”„ Rotated grid for ${e().name}: ${m} unique of ${t(y).length} total (${(m/t(y).length*100).toFixed(0)}% unique)`)}}Ge(()=>{d(),T=setInterval(()=>{v()},3e3)}),Ve(()=>{T&&clearInterval(T)}),L(()=>r(e()),()=>{V(i,e().status==="1"?"approved":e().status==="0"?"rejected":"undecided")}),L(()=>r(e()),()=>{console.log("CityCard data:",e())}),L(()=>r(e()),()=>{V(K,e().images?.length||0)}),L(()=>r(e()),()=>{e().slug&&d()}),$e(),ze();var s=Ze();let j;var N=g(s),A=g(N),W=g(A);{var P=l=>{var a=Ue();let m;xe(a,5,()=>t(y),be,(w,S,C)=>{var c=He();ye(c,`--animation-delay: ${C*.1}s`);var p=g(c);o(c),F(()=>{de(p,"src",t(S)),de(p,"alt",(r(e()),n(()=>e().name)))}),U("load",p,()=>console.log(`âœ… Grid image loaded: ${t(S)}`)),U("error",p,()=>console.error(`âŒ Grid image failed: ${t(S)}`)),_(w,c)}),o(a),F(()=>m=_e(a,1,"image-grid svelte-z1hrta",null,m,{vertical:f()==="triple"})),_(l,a)},ee=l=>{var a=Ie(),m=pe(a);{var w=C=>{var c=Ke();F(()=>{de(c,"src",(r(e()),n(()=>e().images[0]))),de(c,"alt",`${r(e()),n(()=>e().name)??""}, ${r(e()),n(()=>e().country)??""}`)}),U("load",c,()=>console.log(`âœ… Image loaded: ${e().images[0]}`)),U("error",c,()=>console.error(`âŒ Image failed: ${e().images[0]}`)),_(C,c)},S=C=>{var c=Ye(),p=g(c);xe(p,4,()=>Array(12),be,(M,ae,q)=>{var u=Ne();ye(u,`animation-delay: ${q*.15}s`),_(M,u)}),o(p),o(c),_(C,c)};B(m,C=>{r(e()),n(()=>e().images&&e().images.length>0)?C(w):C(S,!1)},!0)}_(l,a)};B(W,l=>{r(f()),t(y),n(()=>(f()==="single"||f()==="triple")&&t(y).length>0)?l(P):l(ee,!1)})}var k=I(W,2),D=g(k),Y=g(D),ue=g(Y,!0);o(Y);var oe=I(Y,2),ge=g(oe,!0);o(oe),o(D);var ne=I(D,2);{var ce=l=>{var a=We(),m=g(a);{var w=u=>{var z=Je(),X=g(z),Se=g(X,!0);o(X),o(z),F(()=>E(Se,(r(e()),n(()=>e().description)))),_(u,z)};B(m,u=>{r(e()),n(()=>e().description)&&u(w)})}var S=I(m,2),C=g(S);{var c=u=>{var z=Oe(),X=g(z);o(z),F(()=>E(X,`ðŸŒ¤ï¸ ${r(e()),n(()=>e().weather)??""}`)),_(u,z)};B(C,u=>{r(e()),n(()=>e().weather)&&u(c)})}var p=I(C,2);{var M=u=>{var z=Qe(),X=g(z);o(z),F(()=>E(X,`ðŸ½ï¸ ${r(e()),n(()=>e().food)??""}`)),_(u,z)};B(p,u=>{r(e()),n(()=>e().food)&&u(M)})}var ae=I(p,2);{var q=u=>{var z=Te(),X=g(z);o(z),F(()=>E(X,`ðŸŒ™ ${r(e()),n(()=>e().nightlife)??""}`)),_(u,z)};B(ae,u=>{r(e()),n(()=>e().nightlife)&&u(q)})}o(S),o(a),_(l,a)};B(ne,l=>{r(e()),n(()=>e().description||e().weather||e().food||e().nightlife)&&l(ce)})}o(k),o(A),o(N);var fe=I(N,2);{var ve=l=>{var a=Xe();_(l,a)};B(fe,l=>{O()&&l(ve)})}o(s),F(()=>{j=_e(s,1,`city-card ${f()??""} ${Z()??""} ${b()??""} ${t(i)??""}`,"svelte-z1hrta",j,{selected:O(),disabled:h(),interactive:R()}),s.disabled=h(),E(ue,(r(e()),n(()=>e().name))),E(ge,(r(e()),n(()=>e().country)))}),U("click",s,te),U("mouseenter",s,se),U("focus",s,re),_(ie,s),we()}var tt=$("<div></div>");function st(ie,x){Ce(x,!1);const i=J(),K=J();let e=G(x,"cities",24,()=>[]),f=G(x,"cardCount",8,1),Z=G(x,"layout",8,"horizontal"),b=G(x,"interactive",8,!0),R=G(x,"selectedCities",24,()=>[]),O=G(x,"disabledCities",24,()=>[]);const h=ke();function Q(d,v){if(v==="horizontal")return{columns:d,rows:1};if(v==="vertical")return{columns:1,rows:d};if(v==="triad")return{columns:3,rows:1};switch(d){case 1:return{columns:1,rows:1};case 2:return{columns:2,rows:1};case 3:return{columns:3,rows:1};case 4:return{columns:2,rows:2};default:return{columns:1,rows:1}}}function te(d){switch(d){case 1:return"single";case 2:return"pair";case 3:return"triple";case 4:return"quad";default:return"single"}}function se(d,v){return v===1?"center":v===2?d===0?"left":"right":v===3?d===0?"left":d===1?"center":"right":v===4&&["top-left","top-right","bottom-left","bottom-right"][d]||"center"}function re(d,v){h("citySelect",{city:d.detail.city,index:v})}function y(d,v){h("cityHover",{city:d.detail.city,index:v})}function T(d,v){h("cityFocus",{city:d.detail.city,index:v})}L(()=>(r(e()),r(f())),()=>{V(i,e().slice(0,f()))}),L(()=>(r(f()),r(Z())),()=>{V(K,Q(f(),Z()))}),$e(),ze();var H=tt();xe(H,5,()=>t(i),be,(d,v,s)=>{{let j=le(()=>(r(f()),n(()=>te(f())))),N=le(()=>(r(f()),n(()=>se(s,f())))),A=le(()=>(r(R()),t(v),n(()=>R().includes(t(v).slug)))),W=le(()=>(r(O()),t(v),n(()=>O().includes(t(v).slug))));et(d,{get city(){return t(v)},get variant(){return t(j)},get position(){return t(N)},size:"medium",get interactive(){return b()},get selected(){return t(A)},get disabled(){return t(W)},$$events:{select:P=>re(P,s),hover:P=>y(P,s),focus:P=>T(P,s)}})}}),o(H),F(()=>{_e(H,1,`city-card-grid ${Z()??""}`,"svelte-efmsim"),ye(H,`--grid-columns: ${t(K),n(()=>t(K).columns)??""}; --grid-rows: ${t(K),n(()=>t(K).rows)??""};`)}),_(ie,H),we()}var at=$(`<div class="voting-complete svelte-1xlijvp"><h3 class="svelte-1xlijvp">ðŸŽ‰ Voting Complete!</h3> <p class="svelte-1xlijvp">You've made decisions on all cities.</p></div>`),it=$('<div class="city-cards-area svelte-1xlijvp"><!></div>'),rt=$('<div class="voting-controls svelte-1xlijvp"><h3 class="svelte-1xlijvp">Vote on City</h3> <div class="current-city-info svelte-1xlijvp"><div class="city-name svelte-1xlijvp"> </div> <div class="city-country svelte-1xlijvp"> </div></div> <div class="vote-buttons svelte-1xlijvp"><button class="vote-btn approve svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">â†‘</span> <span class="vote-text svelte-1xlijvp">Approve</span></button> <button class="vote-btn reject svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">â†“</span> <span class="vote-text svelte-1xlijvp">Reject</span></button></div> <div class="progress-info svelte-1xlijvp"> <br/> </div></div>'),ot=$('<div class="loading svelte-1xlijvp">Loading...</div>'),nt=$("<!> ",1);function Ct(ie,x){Ce(x,!1);const i=()=>me(Be,"$currentSession",f),K=()=>me(Re,"$progress",f),e=()=>me(Le,"$binaryString",f),[f,Z]=Pe(),b=J(),R=J(),O=J();let h=J(0);function Q(){!i()||!t(b)||(console.log(`âœ… Approving ${t(b).name}`),je(t(b).slug,"1"),se())}function te(){!i()||!t(b)||(console.log(`âŒ Rejecting ${t(b).name}`),je(t(b).slug,"0"),se())}function se(){if(!i())return;const s=i().cities.findIndex((j,N)=>N>t(h)&&j.status==="?");s!==-1?(V(h,s),console.log(`ðŸ“ Moving to city ${s+1}: ${i().cities[s].name}`)):(console.log("ðŸŽ‰ Voting complete!"),Ee(),he(resultsPath))}function re(s){if(i())switch(s.key){case"ArrowUp":s.preventDefault(),Q();break;case"ArrowDown":s.preventDefault(),te();break}}L(()=>(i(),t(h)),()=>{if(i()&&i().cities){const s=i().cities.findIndex(j=>j.status==="?");s!==-1&&t(h)!==s&&(V(h,s),console.log(`ðŸ”„ Set current city index to ${t(h)} (first undecided: ${i().cities[t(h)]?.name})`))}}),L(()=>(i(),t(h)),()=>{V(b,i()?.cities[t(h)])}),L(()=>i(),()=>{V(R,i()?.cities.filter(s=>s.status==="?").length||0)}),L(()=>i(),()=>{V(O,i()?[...i().cities].sort((s,j)=>s.name.localeCompare(j.name)):[])}),L(()=>(i(),he),()=>{i()?.isComplete&&he(resultsPath)}),$e(),ze();var y=nt();Ae("1xlijvp",s=>{Me.title="City Voting - City Voting System"}),U("keydown",qe,re);var T=pe(y);{var H=s=>{De(s,{title:"City Voting",get progress(){return K()},get binaryString(){return e()},get cities(){return t(O)},controls:"Press â†‘ to approve this city, â†“ to reject it.",showBackButton:!0,children:(j,N)=>{var A=it(),W=g(A);{var P=k=>{{let D=le(()=>[t(b)]);st(k,{get cities(){return t(D)},cardCount:1,layout:"horizontal",$$events:{citySelect:Y=>console.log("City selected:",Y.detail)}})}},ee=k=>{var D=at();_(k,D)};B(W,k=>{t(b)?k(P):k(ee,!1)})}o(A),_(j,A)},$$slots:{default:!0,"voting-actions":(j,N)=>{var A=Ie(),W=pe(A);{var P=ee=>{var k=rt(),D=I(g(k),2),Y=g(D),ue=g(Y,!0);o(Y);var oe=I(Y,2),ge=g(oe,!0);o(oe),o(D);var ne=I(D,2),ce=g(ne),fe=I(ce,2);o(ne);var ve=I(ne,2),l=g(ve),a=I(l,2);o(ve),o(k),F(()=>{E(ue,(t(b),n(()=>t(b).name))),E(ge,(t(b),n(()=>t(b).country))),E(l,`City ${t(h)+1} of ${i(),n(()=>i().cities.length)??""} `),E(a,` ${t(R)??""} remaining`)}),U("click",ce,Q),U("click",fe,te),_(ee,k)};B(W,ee=>{t(b)&&ee(P)})}_(j,A)}}})},d=s=>{var j=ot();_(s,j)};B(T,s=>{i()?s(H):s(d,!1)})}var v=I(T);F(()=>E(v,` const resultsPath = \`$${Fe??""}/results\`;`)),_(ie,y),we(),Z()}export{Ct as component};
