import"../chunks/CWj6FrbW.js";import"../chunks/CUGcy999.js";import{af as we,ao as F,m as P,T as J,ad as r,ap as $e,ag as $,am as f,k as t,u as o,ah as V,an as n,aq as R,aj as p,ak as ze,av as pe,ai as _e,q as ce,al as qe,aw as Ge}from"../chunks/D4nwEpnC.js";import{c as Se,o as Ve,b as Ae,a as U,e as H}from"../chunks/D823aWX5.js";import{i as D}from"../chunks/0hrKbzKX.js";import{h as Pe}from"../chunks/CRo46d9o.js";import{i as je}from"../chunks/CI4_eMif.js";import{s as Be,a as me}from"../chunks/Du0o-kX8.js";import{s as ye,a as be,B as De}from"../chunks/DqqvGmaA.js";import{e as Ce,i as xe}from"../chunks/CKtu-Lia.js";import{p as A}from"../chunks/DloNT35q.js";import{s as ue}from"../chunks/D-n5Fj80.js";import{b as Ie,g as he}from"../chunks/Dm1nP_b9.js";import{c as Fe,u as ke,b as Ee,d as Le,p as Re}from"../chunks/BwBeiSoE.js";var He=$('<div class="grid-cell svelte-z1hrta"><img class="grid-image svelte-z1hrta"/></div>'),Ue=$("<div></div>"),Ke=$('<img class="hero-image svelte-z1hrta"/>'),Ne=$('<div class="pattern-dot svelte-z1hrta"></div>'),Ye=$('<div class="hero-fallback svelte-z1hrta"><div class="fallback-pattern svelte-z1hrta"></div></div>'),Je=$('<div class="detail-item description svelte-z1hrta"><span class="detail-text svelte-z1hrta"> </span></div>'),Oe=$('<span class="tag weather svelte-z1hrta"> </span>'),Qe=$('<span class="tag food svelte-z1hrta"> </span>'),Te=$('<span class="tag nightlife svelte-z1hrta"> </span>'),We=$('<div class="city-details svelte-z1hrta"><!> <div class="detail-tags svelte-z1hrta"><!> <!> <!></div></div>'),Xe=$('<div class="selection-overlay svelte-z1hrta"><div class="selection-pulse svelte-z1hrta"></div></div>'),Ze=$('<button><div class="city-content svelte-z1hrta"><div class="city-hero svelte-z1hrta"><!> <div class="city-info-panel svelte-z1hrta"><div class="city-title-section svelte-z1hrta"><h1 class="city-title svelte-z1hrta"> </h1> <div class="city-location svelte-z1hrta"> </div></div> <!></div></div></div> <!></button>');function et(ne,b){we(b,!1);const a=J(),K=J();let e=A(b,"city",8),m=A(b,"variant",8,"single"),ee=A(b,"position",8,"center"),C=A(b,"size",8,"medium"),E=A(b,"interactive",8,!0),O=A(b,"selected",8,!1),B=A(b,"disabled",8,!1);const Q=Se();function te(){!E()||B()||Q("select",{city:e()})}function I(){!E()||B()||Q("hover",{city:e()})}function ie(){!E()||B()||Q("focus",{city:e()})}let _=J([]),T;function L(u){const s=[...u];for(let l=s.length-1;l>0;l--){const y=Math.floor(Math.random()*(l+1));[s[l],s[y]]=[s[y],s[l]]}return s}function v(){if((m()==="single"||m()==="triple")&&e().images&&e().images.length>0){const u=m()==="triple"?3:9;if(e().images.length>=u)P(_,L([...e().images]).slice(0,u));else{const l=[],y=[...e().images],M=L([...y]);l.push(...M);const x=u-y.length;for(let c=0;c<x;c++){const h=new Map;y.forEach(G=>h.set(G,0)),l.forEach((G,g)=>{const w=1/(l.length-g);h.set(G,(h.get(G)||0)+w)});let q=y[0],re=h.get(q)||0;for(const G of y){const g=h.get(G)||0;g<re&&(re=g,q=G)}l.push(q)}P(_,l)}const s=new Set(t(_)).size;console.log(`üé≠ Grid for ${e().name}: ${t(_).length} total, ${s} unique (${(s/t(_).length*100).toFixed(0)}% unique)`)}}function d(){if(m()==="single"&&e().images&&e().images.length>1){if(e().images.length<3){console.log(`‚è≥ Skipping rotation for ${e().name}: only ${e().images.length} images available`);return}const u=Math.min(Math.floor(Math.random()*2)+1,e().images.length-t(_).length),s=[...t(_)];for(let y=0;y<u;y++){const M=Math.floor(Math.random()*s.length);let x=0,c;const h=e().images.filter(q=>!s.includes(q));if(h.length>0){const q=Math.floor(Math.random()*h.length);c=h[q]}else do{const q=Math.floor(Math.random()*e().images.length);if(c=e().images[q],x++,!(s[M]===c&&x<20||s.filter(G=>G===c).length>0&&x<20))break}while(x<25);s[M]=c}P(_,s);const l=new Set(t(_)).size;console.log(`üîÑ Rotated grid for ${e().name}: ${l} unique of ${t(_).length} total (${(l/t(_).length*100).toFixed(0)}% unique)`)}}Ve(()=>{v(),T=setInterval(()=>{d()},3e3)}),Ae(()=>{T&&clearInterval(T)}),F(()=>r(e()),()=>{P(a,e().status==="1"?"approved":e().status==="0"?"rejected":"undecided")}),F(()=>r(e()),()=>{console.log("CityCard data:",e())}),F(()=>r(e()),()=>{P(K,e().images?.length||0)}),F(()=>r(e()),()=>{e().slug&&v()}),$e(),je();var z=Ze();let se;var i=f(z),j=f(i),W=f(j);{var k=u=>{var s=Ue();let l;Ce(s,5,()=>t(_),xe,(y,M,x)=>{var c=He();be(c,`--animation-delay: ${x*.1}s`);var h=f(c);n(c),R(()=>{ue(h,"src",t(M)),ue(h,"alt",(r(e()),o(()=>e().name)))}),H("load",h,()=>console.log(`‚úÖ Grid image loaded: ${t(M)}`)),H("error",h,()=>console.error(`‚ùå Grid image failed: ${t(M)}`)),p(y,c)}),n(s),R(()=>l=ye(s,1,"image-grid svelte-z1hrta",null,l,{vertical:m()==="triple"})),p(u,s)},oe=u=>{var s=pe(),l=_e(s);{var y=x=>{var c=Ke();R(()=>{ue(c,"src",(r(e()),o(()=>e().images[0]))),ue(c,"alt",`${r(e()),o(()=>e().name)??""}, ${r(e()),o(()=>e().country)??""}`)}),H("load",c,()=>console.log(`‚úÖ Image loaded: ${e().images[0]}`)),H("error",c,()=>console.error(`‚ùå Image failed: ${e().images[0]}`)),p(x,c)},M=x=>{var c=Ye(),h=f(c);Ce(h,4,()=>Array(12),xe,(q,re,G)=>{var g=Ne();be(g,`animation-delay: ${G*.15}s`),p(q,g)}),n(h),n(c),p(x,c)};D(l,x=>{r(e()),o(()=>e().images&&e().images.length>0)?x(y):x(M,!1)},!0)}p(u,s)};D(W,u=>{r(m()),t(_),o(()=>(m()==="single"||m()==="triple")&&t(_).length>0)?u(k):u(oe,!1)})}var ae=V(W,2),N=f(ae),S=f(N),Y=f(S,!0);n(S);var X=V(S,2),ge=f(X,!0);n(X),n(N);var ve=V(N,2);{var fe=u=>{var s=We(),l=f(s);{var y=g=>{var w=Je(),Z=f(w),Me=f(Z,!0);n(Z),n(w),R(()=>U(Me,(r(e()),o(()=>e().description)))),p(g,w)};D(l,g=>{r(e()),o(()=>e().description)&&g(y)})}var M=V(l,2),x=f(M);{var c=g=>{var w=Oe(),Z=f(w);n(w),R(()=>U(Z,`üå§Ô∏è ${r(e()),o(()=>e().weather)??""}`)),p(g,w)};D(x,g=>{r(e()),o(()=>e().weather)&&g(c)})}var h=V(x,2);{var q=g=>{var w=Qe(),Z=f(w);n(w),R(()=>U(Z,`üçΩÔ∏è ${r(e()),o(()=>e().food)??""}`)),p(g,w)};D(h,g=>{r(e()),o(()=>e().food)&&g(q)})}var re=V(h,2);{var G=g=>{var w=Te(),Z=f(w);n(w),R(()=>U(Z,`üåô ${r(e()),o(()=>e().nightlife)??""}`)),p(g,w)};D(re,g=>{r(e()),o(()=>e().nightlife)&&g(G)})}n(M),n(s),p(u,s)};D(ve,u=>{r(e()),o(()=>e().description||e().weather||e().food||e().nightlife)&&u(fe)})}n(ae),n(j),n(i);var le=V(i,2);{var de=u=>{var s=Xe();p(u,s)};D(le,u=>{O()&&u(de)})}n(z),R(()=>{se=ye(z,1,`city-card ${m()??""} ${ee()??""} ${C()??""} ${t(a)??""}`,"svelte-z1hrta",se,{selected:O(),disabled:B(),interactive:E()}),z.disabled=B(),U(Y,(r(e()),o(()=>e().name))),U(ge,(r(e()),o(()=>e().country)))}),H("click",z,te),H("mouseenter",z,I),H("focus",z,ie),p(ne,z),ze()}var tt=$("<div></div>");function it(ne,b){we(b,!1);const a=J(),K=J();let e=A(b,"cities",24,()=>[]),m=A(b,"cardCount",8,1),ee=A(b,"layout",8,"horizontal"),C=A(b,"interactive",8,!0),E=A(b,"selectedCities",24,()=>[]),O=A(b,"disabledCities",24,()=>[]);const B=Se();function Q(v,d){if(d==="horizontal")return{columns:v,rows:1};if(d==="vertical")return{columns:1,rows:v};if(d==="triad")return{columns:3,rows:1};switch(v){case 1:return{columns:1,rows:1};case 2:return{columns:2,rows:1};case 3:return{columns:3,rows:1};case 4:return{columns:2,rows:2};default:return{columns:1,rows:1}}}function te(v){switch(v){case 1:return"single";case 2:return"pair";case 3:return"triple";case 4:return"quad";default:return"single"}}function I(v,d){return d===1?"center":d===2?v===0?"left":"right":d===3?v===0?"left":v===1?"center":"right":d===4&&["top-left","top-right","bottom-left","bottom-right"][v]||"center"}function ie(v,d){B("citySelect",{city:v.detail.city,index:d})}function _(v,d){B("cityHover",{city:v.detail.city,index:d})}function T(v,d){B("cityFocus",{city:v.detail.city,index:d})}F(()=>(r(e()),r(m())),()=>{P(a,e().slice(0,m()))}),F(()=>(r(m()),r(ee())),()=>{P(K,Q(m(),ee()))}),$e(),je();var L=tt();Ce(L,5,()=>t(a),xe,(v,d,z)=>{{let se=ce(()=>(r(m()),o(()=>te(m())))),i=ce(()=>(r(m()),o(()=>I(z,m())))),j=ce(()=>(r(E()),t(d),o(()=>E().includes(t(d).slug)))),W=ce(()=>(r(O()),t(d),o(()=>O().includes(t(d).slug))));et(v,{get city(){return t(d)},get variant(){return t(se)},get position(){return t(i)},size:"medium",get interactive(){return C()},get selected(){return t(j)},get disabled(){return t(W)},$$events:{select:k=>ie(k,z),hover:k=>_(k,z),focus:k=>T(k,z)}})}}),n(L),R(()=>{ye(L,1,`city-card-grid ${ee()??""}`,"svelte-efmsim"),be(L,`--grid-columns: ${t(K),o(()=>t(K).columns)??""}; --grid-rows: ${t(K),o(()=>t(K).rows)??""};`)}),p(ne,L),ze()}var st=$(`<div class="voting-complete svelte-1xlijvp"><h3 class="svelte-1xlijvp">üéâ Voting Complete!</h3> <p class="svelte-1xlijvp">You've made decisions on all cities.</p></div>`),at=$('<div class="city-cards-area svelte-1xlijvp"><!></div>'),rt=$('<div class="voting-controls svelte-1xlijvp"><h3 class="svelte-1xlijvp">Vote on City</h3> <div class="current-city-info svelte-1xlijvp"><div class="city-name svelte-1xlijvp"> </div> <div class="city-country svelte-1xlijvp"> </div></div> <div class="vote-buttons svelte-1xlijvp"><button class="vote-btn approve svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">‚Üë</span> <span class="vote-text svelte-1xlijvp">Approve</span></button> <button class="vote-btn reject svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">‚Üì</span> <span class="vote-text svelte-1xlijvp">Reject</span></button></div> <div class="progress-info svelte-1xlijvp"> <br/> </div></div>'),nt=$('<div class="loading svelte-1xlijvp">Loading...</div>');function Ct(ne,b){we(b,!1);const a=()=>me(Fe,"$currentSession",m),K=()=>me(Re,"$progress",m),e=()=>me(Le,"$binaryString",m),[m,ee]=Be(),C=J(),E=J(),O=J();function B(){if(Ie)return Ie;if(typeof window>"u")return"";const i=window.location.pathname.match(/^\/[^/]+/);return i?i[0]:""}const Q=B(),te=Q?`${Q}/results`:"/results";let I=J(0);function ie(){!a()||!t(C)||(console.log(`‚úÖ Approving ${t(C).name}`),ke(t(C).slug,"1"),T())}function _(){!a()||!t(C)||(console.log(`‚ùå Rejecting ${t(C).name}`),ke(t(C).slug,"0"),T())}function T(){if(!a())return;const i=a().cities.findIndex((j,W)=>W>t(I)&&j.status==="?");i!==-1?(P(I,i),console.log(`üìç Moving to city ${i+1}: ${a().cities[i].name}`)):(console.log("üéâ Voting complete!"),Ee(),he(te))}function L(i){if(a())switch(i.key){case"ArrowUp":i.preventDefault(),ie();break;case"ArrowDown":i.preventDefault(),_();break}}F(()=>(a(),t(I)),()=>{if(a()&&a().cities){const i=a().cities.findIndex(j=>j.status==="?");i!==-1&&t(I)!==i&&(P(I,i),console.log(`üîÑ Set current city index to ${t(I)} (first undecided: ${a().cities[t(I)]?.name})`))}}),F(()=>(a(),t(I)),()=>{P(C,a()?.cities[t(I)])}),F(()=>a(),()=>{P(E,a()?.cities.filter(i=>i.status==="?").length||0)}),F(()=>a(),()=>{P(O,a()?[...a().cities].sort((i,j)=>i.name.localeCompare(j.name)):[])}),F(()=>(a(),he),()=>{a()?.isComplete&&he(te)}),$e(),je();var v=pe();Pe("1xlijvp",i=>{qe.title="City Voting - City Voting System"}),H("keydown",Ge,L);var d=_e(v);{var z=i=>{De(i,{title:"City Voting",get progress(){return K()},get binaryString(){return e()},get cities(){return t(O)},controls:"Press ‚Üë to approve this city, ‚Üì to reject it.",showBackButton:!0,children:(j,W)=>{var k=at(),oe=f(k);{var ae=S=>{{let Y=ce(()=>[t(C)]);it(S,{get cities(){return t(Y)},cardCount:1,layout:"horizontal",$$events:{citySelect:X=>console.log("City selected:",X.detail)}})}},N=S=>{var Y=st();p(S,Y)};D(oe,S=>{t(C)?S(ae):S(N,!1)})}n(k),p(j,k)},$$slots:{default:!0,"voting-actions":(j,W)=>{var k=pe(),oe=_e(k);{var ae=N=>{var S=rt(),Y=V(f(S),2),X=f(Y),ge=f(X,!0);n(X);var ve=V(X,2),fe=f(ve,!0);n(ve),n(Y);var le=V(Y,2),de=f(le),u=V(de,2);n(le);var s=V(le,2),l=f(s),y=V(l,2);n(s),n(S),R(()=>{U(ge,(t(C),o(()=>t(C).name))),U(fe,(t(C),o(()=>t(C).country))),U(l,`City ${t(I)+1} of ${a(),o(()=>a().cities.length)??""} `),U(y,` ${t(E)??""} remaining`)}),H("click",de,ie),H("click",u,_),p(N,S)};D(oe,N=>{t(C)&&N(ae)})}p(j,k)}}})},se=i=>{var j=nt();p(i,j)};D(d,i=>{a()?i(z):i(se,!1)})}p(ne,v),ze(),ee()}export{Ct as component};
