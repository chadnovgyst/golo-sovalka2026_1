import"../chunks/CWj6FrbW.js";import"../chunks/CUGcy999.js";import{af as Ae,ao as D,m as f,T as U,ad as l,ap as Ee,ag as w,am as h,k as t,ah as M,u,an as d,aq as H,aj as _,ak as Ve,av as je,ai as $e,q as de,al as He,aw as Ke}from"../chunks/D4nwEpnC.js";import{c as De,o as Le,b as Oe,a as K,e as te}from"../chunks/D823aWX5.js";import{i as R}from"../chunks/0hrKbzKX.js";import{h as Qe}from"../chunks/CRo46d9o.js";import{i as qe}from"../chunks/CI4_eMif.js";import{s as Xe,a as Ce}from"../chunks/Du0o-kX8.js";import{s as ue,a as Ie,B as Ye}from"../chunks/Bci3MFzG.js";import{e as ke,i as Se}from"../chunks/CKtu-Lia.js";import{p as L}from"../chunks/DloNT35q.js";import{s as he}from"../chunks/D-n5Fj80.js";import{b as Be,g as we}from"../chunks/F1KVDnEB.js";import{c as Je,u as Re,b as We,d as Ze,p as et}from"../chunks/CelrTHMO.js";const tt=6;let _e=0;const Me=[],ze=new Map;function pe(){if(_e>=tt)return;const z=Me.shift();z&&z()}function Ge(z){if(!z)return Promise.resolve();const m=ze.get(z);if(m)return m;const a=new Promise((G,e)=>{const c=()=>{_e++;const P=new Image;P.decoding="async",P.loading="eager",P.src=z,P.onload=()=>{_e--,pe(),G()},P.onerror=y=>{ze.delete(z),_e--,pe(),e(y)}};typeof queueMicrotask=="function"?(Me.push(c),queueMicrotask(pe)):(Me.push(c),pe())});return ze.set(z,a),a}function Pe(z){z.forEach(m=>{Ge(m).catch(()=>{})})}var st=w('<div class="hero-skeleton svelte-z1hrta"></div>'),at=w('<div class="grid-cell svelte-z1hrta"><img class="grid-image svelte-z1hrta" loading="eager" decoding="async"/></div>'),it=w("<div></div>"),rt=w('<img loading="eager" decoding="async"/>'),nt=w('<div class="pattern-dot svelte-z1hrta"></div>'),ot=w('<div class="hero-fallback svelte-z1hrta"><div class="fallback-pattern svelte-z1hrta"></div></div>'),lt=w('<div class="detail-item description svelte-z1hrta"><span class="detail-text svelte-z1hrta"> </span></div>'),ct=w('<span class="tag weather svelte-z1hrta"> </span>'),vt=w('<span class="tag food svelte-z1hrta"> </span>'),dt=w('<span class="tag nightlife svelte-z1hrta"> </span>'),ut=w('<div class="city-details svelte-z1hrta"><!> <div class="detail-tags svelte-z1hrta"><!> <!> <!></div></div>'),ft=w('<div class="selection-overlay svelte-z1hrta"><div class="selection-pulse svelte-z1hrta"></div></div>'),gt=w('<button><div class="city-content svelte-z1hrta"><div><!> <!> <div class="city-info-panel svelte-z1hrta"><div class="city-title-section svelte-z1hrta"><h1 class="city-title svelte-z1hrta"> </h1> <div class="city-location svelte-z1hrta"> </div></div> <!></div></div></div> <!></button>');function mt(z,m){Ae(m,!1);const a=U(),G=U();let e=L(m,"city",8),c=L(m,"variant",8,"single"),P=L(m,"position",8,"center"),y=L(m,"size",8,"medium"),F=L(m,"interactive",8,!0),Q=L(m,"selected",8,!1),N=L(m,"disabled",8,!1);const X=De();function ne(){!F()||N()||X("select",{city:e()})}function k(){!F()||N()||X("hover",{city:e()})}function oe(){!F()||N()||X("focus",{city:e()})}let A=U([]),Y,C=U(!1),i=U(!1),r=null;function T(o){const s=[...o];for(let g=s.length-1;g>0;g--){const V=Math.floor(Math.random()*(g+1));[s[g],s[V]]=[s[V],s[g]]}return s}function le(){if((c()==="single"||c()==="triple")&&e().images&&e().images.length>0){const o=c()==="triple"?3:9;if(e().images.length>=o)f(A,T([...e().images]).slice(0,o));else{const s=[],g=[...e().images],V=T([...g]);s.push(...V);const q=o-g.length;for(let b=0;b<q;b++){const v=new Map;g.forEach(B=>v.set(B,0)),s.forEach((B,Z)=>{const x=1/(s.length-Z);v.set(B,(v.get(B)||0)+x)});let p=g[0],re=v.get(p)||0;for(const B of g){const Z=v.get(B)||0;Z<re&&(re=Z,p=B)}s.push(p)}f(A,s)}}}function n(){if(c()==="single"&&e().images&&e().images.length>1){if(e().images.length<3)return;const o=Math.min(Math.floor(Math.random()*2)+1,e().images.length-t(A).length),s=[...t(A)];for(let g=0;g<o;g++){const V=Math.floor(Math.random()*s.length);let q=0,b;const v=e().images.filter(p=>!s.includes(p));if(v.length>0){const p=Math.floor(Math.random()*v.length);b=v[p]}else do{const p=Math.floor(Math.random()*e().images.length);if(b=e().images[p],q++,!(s[V]===b&&q<20||s.filter(B=>B===b).length>0&&q<20))break}while(q<25);s[V]=b}f(A,s)}}Le(()=>{le(),Y=setInterval(()=>{n()},3e3)}),Oe(()=>{Y&&clearInterval(Y)});function j(){const o=`${e().slug}|${c()}`;if(!e().images||!e().images.length){f(C,!0),f(i,!0),r=o;return}if(o===r)return;r=o,f(C,!1),f(i,!1);const s=e().heroImage||e().images[0];s?Ge(s).then(()=>{f(i,!0),f(C,!0)}).catch(()=>{f(i,!0),f(C,!0)}):(f(i,!0),f(C,!0));const g=c()==="triple"?3:9;Pe(e().images.slice(0,g))}Le(()=>{j()}),D(()=>l(e()),()=>{f(a,e().status==="1"?"approved":e().status==="0"?"rejected":"undecided")}),D(()=>l(e()),()=>{f(G,e().images?.length||0)}),D(()=>l(e()),()=>{e().slug&&le()}),D(()=>l(e()),()=>{e().slug&&j()}),Ee(),qe();var S=gt();let $;var se=h(S),ae=h(se);let J;var E=h(ae);{var O=o=>{var s=st();_(o,s)};R(E,o=>{t(C)||o(O)})}var W=M(E,2);{var ye=o=>{var s=it();let g;ke(s,5,()=>t(A),Se,(V,q,b)=>{var v=at();Ie(v,`--animation-delay: ${b*.1}s`);var p=h(v);d(v),H(()=>{he(p,"src",t(q)),he(p,"alt",(l(e()),u(()=>e().name)))}),te("load",p,()=>{t(C)||f(C,!0)}),_(V,v)}),d(s),H(()=>g=ue(s,1,"image-grid svelte-z1hrta",null,g,{vertical:c()==="triple"})),_(o,s)},fe=o=>{var s=je(),g=$e(s);{var V=b=>{var v=rt();let p;H(()=>{he(v,"src",(l(e()),u(()=>e().images[0]))),he(v,"alt",`${l(e()),u(()=>e().name)??""}, ${l(e()),u(()=>e().country)??""}`),p=ue(v,1,"hero-image svelte-z1hrta",null,p,{loaded:t(i)})}),te("load",v,()=>{f(i,!0),f(C,!0)}),_(b,v)},q=b=>{var v=ot(),p=h(v);ke(p,4,()=>Array(12),Se,(re,B,Z)=>{var x=nt();Ie(x,`animation-delay: ${Z*.15}s`),_(re,x)}),d(p),d(v),_(b,v)};R(g,b=>{l(e()),u(()=>e().images&&e().images.length>0)?b(V):b(q,!1)},!0)}_(o,s)};R(W,o=>{l(c()),t(A),u(()=>(c()==="single"||c()==="triple")&&t(A).length>0)?o(ye):o(fe,!1)})}var ge=M(W,2),ie=h(ge),ce=h(ie),be=h(ce,!0);d(ce);var ve=M(ce,2),me=h(ve,!0);d(ve),d(ie);var xe=M(ie,2);{var Ne=o=>{var s=ut(),g=h(s);{var V=x=>{var I=lt(),ee=h(I),Te=h(ee,!0);d(ee),d(I),H(()=>K(Te,(l(e()),u(()=>e().description)))),_(x,I)};R(g,x=>{l(e()),u(()=>e().description)&&x(V)})}var q=M(g,2),b=h(q);{var v=x=>{var I=ct(),ee=h(I);d(I),H(()=>K(ee,`🌤️ ${l(e()),u(()=>e().weather)??""}`)),_(x,I)};R(b,x=>{l(e()),u(()=>e().weather)&&x(v)})}var p=M(b,2);{var re=x=>{var I=vt(),ee=h(I);d(I),H(()=>K(ee,`🍽️ ${l(e()),u(()=>e().food)??""}`)),_(x,I)};R(p,x=>{l(e()),u(()=>e().food)&&x(re)})}var B=M(p,2);{var Z=x=>{var I=dt(),ee=h(I);d(I),H(()=>K(ee,`🌙 ${l(e()),u(()=>e().nightlife)??""}`)),_(x,I)};R(B,x=>{l(e()),u(()=>e().nightlife)&&x(Z)})}d(q),d(s),_(o,s)};R(xe,o=>{l(e()),u(()=>e().description||e().weather||e().food||e().nightlife)&&o(Ne)})}d(ge),d(ae),d(se);var Ue=M(se,2);{var Fe=o=>{var s=ft();_(o,s)};R(Ue,o=>{Q()&&o(Fe)})}d(S),H(()=>{$=ue(S,1,`city-card ${c()??""} ${P()??""} ${y()??""} ${t(a)??""}`,"svelte-z1hrta",$,{selected:Q(),disabled:N(),interactive:F()}),S.disabled=N(),J=ue(ae,1,"city-hero svelte-z1hrta",null,J,{loaded:t(C)}),K(be,(l(e()),u(()=>e().name))),K(me,(l(e()),u(()=>e().country)))}),te("click",S,ne),te("mouseenter",S,k),te("focus",S,oe),_(z,S),Ve()}var ht=w("<div></div>");function pt(z,m){Ae(m,!1);const a=U(),G=U();let e=L(m,"cities",24,()=>[]),c=L(m,"cardCount",8,1),P=L(m,"layout",8,"horizontal"),y=L(m,"interactive",8,!0),F=L(m,"selectedCities",24,()=>[]),Q=L(m,"disabledCities",24,()=>[]);const N=De();function X(i,r){if(r==="horizontal")return{columns:i,rows:1};if(r==="vertical")return{columns:1,rows:i};if(r==="triad")return{columns:3,rows:1};switch(i){case 1:return{columns:1,rows:1};case 2:return{columns:2,rows:1};case 3:return{columns:3,rows:1};case 4:return{columns:2,rows:2};default:return{columns:1,rows:1}}}function ne(i){switch(i){case 1:return"single";case 2:return"pair";case 3:return"triple";case 4:return"quad";default:return"single"}}function k(i,r){return r===1?"center":r===2?i===0?"left":"right":r===3?i===0?"left":i===1?"center":"right":r===4&&["top-left","top-right","bottom-left","bottom-right"][i]||"center"}function oe(i,r){N("citySelect",{city:i.detail.city,index:r})}function A(i,r){N("cityHover",{city:i.detail.city,index:r})}function Y(i,r){N("cityFocus",{city:i.detail.city,index:r})}D(()=>(l(e()),l(c())),()=>{f(a,e().slice(0,c()))}),D(()=>(t(a),Pe),()=>{if(t(a).length){const i=t(a).map(r=>r.heroImage??r.images?.[0]).filter(r=>!!r);Pe(i)}}),D(()=>(l(c()),l(P())),()=>{f(G,X(c(),P()))}),Ee(),qe();var C=ht();ke(C,5,()=>t(a),Se,(i,r,T)=>{{let le=de(()=>(l(c()),u(()=>ne(c())))),n=de(()=>(l(c()),u(()=>k(T,c())))),j=de(()=>(l(F()),t(r),u(()=>F().includes(t(r).slug)))),S=de(()=>(l(Q()),t(r),u(()=>Q().includes(t(r).slug))));mt(i,{get city(){return t(r)},get variant(){return t(le)},get position(){return t(n)},size:"medium",get interactive(){return y()},get selected(){return t(j)},get disabled(){return t(S)},$$events:{select:$=>oe($,T),hover:$=>A($,T),focus:$=>Y($,T)}})}}),d(C),H(()=>{ue(C,1,`city-card-grid ${P()??""}`,"svelte-efmsim"),Ie(C,`--grid-columns: ${t(G),u(()=>t(G).columns)??""}; --grid-rows: ${t(G),u(()=>t(G).rows)??""};`)}),_(z,C),Ve()}var _t=w(`<div class="voting-complete svelte-1xlijvp"><h3 class="svelte-1xlijvp">🎉 Voting Complete!</h3> <p class="svelte-1xlijvp">You've made decisions on all cities.</p></div>`),yt=w('<div class="city-cards-area svelte-1xlijvp"><!></div>'),bt=w('<div class="voting-controls svelte-1xlijvp"><h3 class="svelte-1xlijvp">Vote on City</h3> <div class="current-city-info svelte-1xlijvp"><div class="city-name svelte-1xlijvp"> </div> <div class="city-country svelte-1xlijvp"> </div></div> <div class="vote-buttons svelte-1xlijvp"><button class="vote-btn approve svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">↑</span> <span class="vote-text svelte-1xlijvp">Approve</span></button> <button class="vote-btn reject svelte-1xlijvp"><span class="vote-icon svelte-1xlijvp">↓</span> <span class="vote-text svelte-1xlijvp">Reject</span></button></div> <div class="progress-info svelte-1xlijvp"> <br/> </div></div>'),xt=w('<div class="loading svelte-1xlijvp">Loading...</div>');function Lt(z,m){Ae(m,!1);const a=()=>Ce(Je,"$currentSession",c),G=()=>Ce(et,"$progress",c),e=()=>Ce(Ze,"$binaryString",c),[c,P]=Xe(),y=U(),F=U(),Q=U();function N(){if(Be)return Be;if(typeof window>"u")return"";const n=window.location.pathname.match(/^\/[^/]+/);return n?n[0]:""}const X=N(),ne=X?`${X}/results`:"/results";let k=U(0);function oe(){!a()||!t(y)||(console.log(`✅ Approving ${t(y).name}`),Re(t(y).slug,"1"),Y())}function A(){!a()||!t(y)||(console.log(`❌ Rejecting ${t(y).name}`),Re(t(y).slug,"0"),Y())}function Y(){if(!a())return;const n=a().cities.findIndex((j,S)=>S>t(k)&&j.status==="?");n!==-1?(f(k,n),console.log(`📍 Moving to city ${n+1}: ${a().cities[n].name}`)):(console.log("🎉 Voting complete!"),We(),we(ne))}function C(n){if(a())switch(n.key){case"ArrowUp":n.preventDefault(),oe();break;case"ArrowDown":n.preventDefault(),A();break}}D(()=>(a(),t(k)),()=>{if(a()&&a().cities){const n=a().cities.findIndex(j=>j.status==="?");n!==-1&&t(k)!==n&&(f(k,n),console.log(`🔄 Set current city index to ${t(k)} (first undecided: ${a().cities[t(k)]?.name})`))}}),D(()=>(a(),t(k)),()=>{f(y,a()?.cities[t(k)])}),D(()=>a(),()=>{f(F,a()?.cities.filter(n=>n.status==="?").length||0)}),D(()=>a(),()=>{f(Q,a()?[...a().cities].sort((n,j)=>n.name.localeCompare(j.name)):[])}),D(()=>(a(),we),()=>{a()?.isComplete&&we(ne)}),Ee(),qe();var i=je();Qe("1xlijvp",n=>{He.title="City Voting - City Voting System"}),te("keydown",Ke,C);var r=$e(i);{var T=n=>{Ye(n,{title:"City Voting",get progress(){return G()},get binaryString(){return e()},get cities(){return t(Q)},controls:"Press ↑ to approve this city, ↓ to reject it.",showBackButton:!0,children:(j,S)=>{var $=yt(),se=h($);{var ae=E=>{{let O=de(()=>[t(y)]);pt(E,{get cities(){return t(O)},cardCount:1,layout:"horizontal",$$events:{citySelect:W=>console.log("City selected:",W.detail)}})}},J=E=>{var O=_t();_(E,O)};R(se,E=>{t(y)?E(ae):E(J,!1)})}d($),_(j,$)},$$slots:{default:!0,"voting-actions":(j,S)=>{var $=je(),se=$e($);{var ae=J=>{var E=bt(),O=M(h(E),2),W=h(O),ye=h(W,!0);d(W);var fe=M(W,2),ge=h(fe,!0);d(fe),d(O);var ie=M(O,2),ce=h(ie),be=M(ce,2);d(ie);var ve=M(ie,2),me=h(ve),xe=M(me,2);d(ve),d(E),H(()=>{K(ye,(t(y),u(()=>t(y).name))),K(ge,(t(y),u(()=>t(y).country))),K(me,`City ${t(k)+1} of ${a(),u(()=>a().cities.length)??""} `),K(xe,` ${t(F)??""} remaining`)}),te("click",ce,oe),te("click",be,A),_(J,E)};R(se,J=>{t(y)&&J(ae)})}_(j,$)}}})},le=n=>{var j=xt();_(n,j)};R(r,n=>{a()?n(T):n(le,!1)})}_(z,i),Ve(),P()}export{Lt as component};
